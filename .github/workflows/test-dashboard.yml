name: Test ESPHome Dashboard Integration

# Run on all pushes and pull requests to verify dashboard integration
on:
  push:
    branches:
      - '*'
  pull_request: {}

# Cancel previous runs when a new commit is pushed
concurrency:
  group: ${{ github.ref }}-dashboard
  cancel-in-progress: true

jobs:
  test-dashboard-integration:
    # Only run if commit/PR doesn't contain [skip ci]
    if: |
      !contains(github.event.head_commit.message || '', '[skip ci]') &&
      !contains(github.event.pull_request.title || '', '[skip ci]')

    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name: Setup Node.js 20.x
        uses: actions/setup-node@v6
        with:
          node-version: 20.x

      - name: Setup Python 3.13
        uses: actions/setup-python@v5
        with:
          python-version: '3.13'

      - name: Install Node.js dependencies
        run: npm ci

      - name: Run dashboard integration test
        run: npm run test:integration-dashboard
        timeout-minutes: 10
